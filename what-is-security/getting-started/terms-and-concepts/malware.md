# Malware

## Malware Types

Malicious software, or malware comes in different types and they all have different purposes.

Malware can exist at varying levels of the computer architecture, and we would need to understand how these work in order to use / stop them.

<figure><img src="../../../.gitbook/assets/image (1497).png" alt=""><figcaption></figcaption></figure>

### Viruses

A computer program which basically copies itself and spreads without the permission or knowledge of the owner of the device. **These do not spread via exploiting vulnerabilities.**&#x20;

There are 4 types of viruses:

1. Resident
   * When the virus is executed, it becomes a memory resident and waits for other programs to be loaded before infecting them.
   * Loads themself and replaces the process ID that other programs use, hence flying under the radar.
2. Non-Resident
   * When executed, it will search for files that it can infect, then infect those with it and quit.
   * It would repeat this process over and over to infect the PC.
3. Boot-Sector
   * Programs that spread when the machine is booted / turned on, but it is not a rootkit.
4. Multu-partite
   * Multiple infection mechanisms all incorporated into one virus.

### Trojan Horse

Based on the real story of a Trojan Horse, whereby there is malicious code hidden within an innocent looking file. Generally, these do not self-replicate like viruses do, but rather they are used for maintaining access or something.

The most common type of Trojans are Remote Access Trojans (RAT), which are used for hackers to maintain access to a compromised system after managing to load the virus on the machine disk.

### Rootkit

Malware that is designed to hide the fact that a compromise has already been done at a deeper level. These are programs which are hidden even under the Operating system, and they would be extremely hard for anti-viruses to detect them because they literally are under it.

They are normally installed as drivers, where drivers are basically software that link hardware and software together. They are shown to exist at the following levels:

* Application
  * Replaces actual programs with copies of others
* Library
  * Would be able to control multiple applications that are all using the same library
* Kernel (Core of OS)
  * Most common type
  * Runs at the same privilege level at which the AV solutions run, hence avoiding detection.
* Hypervisor
  * MAkes use of processors that support visualization
* Firmware
  * For firmware like BIOS, ACPI or device ROMs.&#x20;
  * HIghest chance of survlval because right now, **there are no tools to verify/scan the firmware level rootkits.**
* Perhaps even lower than firmware.

### Bootkit

Rootkits which grab the OS during the boot process. This virus starts attacking the OS before it even starts properly, hence it is able to completely violate the security of the target OS.

### Backdoor

This is a software which allows for bypassing authentication mechanisms. Backdoors were acutally programs created by engineers to skip through all the password screens and security stuff, in order to quickly troubleshoot protected applications without needing to sign in.

This was easily abused by hackers, who used it to get into the systems. Nowadays, backdoors can be used as a form of persistence within the system by allowing hackers to easily get back onto it.

### Greyware

Greyware is a combination of spyware and adware.

Adware is a program that would install without consent and start showing people random advertisements. This can be used to collect information about the target,

Spyware would allow for the user to spy on another user, and collect information about the activities on our device. Normally, spyware comes with other malware to help hide its tracks, commonly using rootkits.

### Key-Loggers

This software would register every key that is pressed on the keyboard and send it somewhere.

There are numerous kinds and methods of keylogging such as:

* Software - Kernel mode of user mode loggers
* Hardware - Firmware that can be put on the BIOS
* Wireless Keyboard - Passive sniffers
* Acoustic - Based on the sound that is made when striking the key
* Optical - Screen recorders

### Botnets

Collection of compromised computers which run commands autotmatically and autonomously. Commonly mass installed in devices through phishing emails or something, and they are controlled by one computer called a bot master.

Comonly used for DDos or Spam.

### Ransomware

Ransomware is a program that encrypts a hard disk with a hidden key that cannot be decrypted back. Normally, attacks would then demand money or a ransom from the victims before sending them the private key to decrypt the data.

### Worms

Uses network/system vulnerabilities to spread themselves from system to system. This can be part of other software such as a rootkit.

### Polymorphic Virus

This kind of virus is able to edit and change it's own code such that it cannot be traced or have a fixed file signature. Polymorphic code is advanced and able to change its code at will, while still maintaining it's functions.

## Malware Analysing

For us to know what the executable is doing, we would need to debug and reverse engineer it, which isn't as easy because malware creators intentionally included some additional things to make it hard to read and decipher what the software is doing.

Without knowing what the malware is doing, we cannot actually stop it because we cannot isolate the processes it is using.

### Anti-Debugging

Malware can be created such that if a debugger is attached, then it would start to skip sections of the code. Debuggers are basically programs that are able to make malware sort of slowdown and execute line by line for people to see what the program is doing at each step.

This would include putting an exception handler of some sort, and perhaps the program would skip core parts of its code, or perhaps start to run rubbish code in order to avoid detection of the real processes.

<figure><img src="../../../.gitbook/assets/image (257).png" alt=""><figcaption></figcaption></figure>

### Anti-VM

Sometimes, a virtual machine is used to run the malware to keep actual machines safe. VMs provide for a sandbox to do testing of the malware in a safe environment without risk of infecting our underlying OS or any other precious hardware. It's also a lot cheaper compared to buying a whole new laptop just for it to be infected with malware.

However, malware creators are aware of this, and sometimes malware is created to detect if it is on a VM, and it would not run if so. There are methods for programs to detect whether it's on a VM or not.

Foer example, while running on a real machine, the memory usage would be a lot lower compared to if it runs on a VM, which tends to use more memory, and hence the program may not even execute.

### Obfuscation

This involves changing or transforming the code to make it hard to read. One way is changing all variable names to make it hard to follow what's going on, or to make the execution flow of the program extremely hard to follow.

Other examples would include creating malware that would basically change its code should it be viewed, or to have malware with tons and tons of rubbish functions that basically do nothing while keeping the actual code running under.

The major drawback of this is that, if not done properly, sometimes it is not that effective and people are still able to reverse engineer the programs.

<figure><img src="../../../.gitbook/assets/image (1893).png" alt=""><figcaption><p><em>Obfuscated Javascript using non-alphanumeric obfuscation</em></p></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (632).png" alt=""><figcaption><p><em>Assemblty code that has been transformed</em></p></figcaption></figure>

### Packers

This is the software which are used to compress executables, and were initially designed to decrease the size of executable files in the past when memory was much smaller.

However, this can be used to decrease the size of malware, and reduce the chance of it being detected by anti-viruses. This works because most AVs work on file signatures, which basically check for matching patterns.

Packers can encrypt, compress applications, add small loaders to files, resolve imports and maek it such that we cannot see the code in a disassembler, needing to unpack it.

### Polymorphic Code

Changes and mutates the code everytime an action is taken. There's only been a few, and even they aren't detected 100% of the time due to their complexity. This type of malware have constant encoding and variable decrypters.&#x20;

If the mutation is applied to the encoding and decrypters, then this is called **metamorphic code.**

## Spreading

Generally, malware has a few types of methods of spreading

1. Social Engineering
   * Phishing emails
   * Double extensions
   * Malicious emails with files
2. Already infected files
   * Unknowingly, files can already be infected and import more malware this way
3. Peer to peer file sharing
   * This was a service started for music files
   * Today, around 30-40 percent of available files in file-sharing netwokrs are malware
4. Websites
   * Website can execute code when visited and download malware onto our system without our knowledge
   * Leverages some hidden Javascript which is triggered when the HTML is loaded
5. Internet Connect / Local Network
   * Malware can be spread by someone just sitting at a cafe and sending malware to the Internet.
   * At this point, it isn't about security, it's really down to luck
6. Rogue USB / CD
   * Sometimes, there are thumbdrives that are just dropped all over the place, each of which likely have copies of malware within them
   * **Never connect something you found on the floor to your computer.**
   * You'd be surprised at how effective this still is.
