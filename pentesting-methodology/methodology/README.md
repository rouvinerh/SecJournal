---
description: My take on it.
---

# Methodology

A penetration test is basically a simulated attack on an organisation, in the hopes of finding flaws in the security structure and allowing the company to improve on their security posture. Also, it is more objective, because it is done by an external party with no bias towards the company's own security team.

Generally, a full penetration test or vulnerability assessment has a few parts:

1. Reconnaissance
2. Exploiting
3. Privilege Escalation
4. Persistance through Trojans and backdoors
5. Lateral Movement / Pivoting
6. Privilege Escalation again (if needed)
7. Clean Up
8. Report Writing

Before every engagement, there is something called the **Rules of Engagement (ROE).** This is basically a document that says what the pentesters job is, and what is the scope of it. In any legal problems, the ROE protects pentesters because the company has signed it and allow for these tests to happen. The ROE dictates what can and cannot be done during the engagements.&#x20;

**Whatever happens, stay within the scope of the ROE.**

## Reconnaissance

**This is the most important step of any penetration test!**

Why is this the most important? Well, think about if an attack on a real company fails. If it fails, the IT or Security department is immediately able to catch what's wrong and then patch the system, therefore making the job after harder or even failing the engagement.

Ideally, attackers want to launch a extremely well-planned, well thought out plan once with a high rate of success instead of lobbing payload after payload. Think about it like a sniper, shooting once to kill after waiting hours for your target instead of blindly charging in with a pistol. So a very good enumeration of the target is key to planning an attack that will work.

There are generally 3 parts to Reconnaissance, and I like to call them external, detectable and combining.

### External Recon

This is basically your Open Source Intelligence Gathering, or OSINT for short. In this step, what we would do is enumerate our target, **without actually making contact with them.** This means that we are relying on open source information out there to find out more about the target.

This can be stuff like:

* Harvesting emails and contact details
* Checking of DNS and whois records.
* Using Google Dorks to find out all publicly accessible documents regarding the company.
* Looking through rubbish bins to find documents of the company (this is a legit thing, and its called dumpster diving).
* Anything that involves the company not being able to trace us at all. Leave no logs or records.

Some engagements are have the rules of engagement to be external only. In this case, pentesters may have to gain **physical access to the buildings.** This can be done via **lock picking, dressing up as plumbers to gain access into the building, tailgating other employees into the building** and so on.&#x20;

### Detectable Recon

Sometimes, the company might order for an **internal test**, which means that we begin on the inside. This means that stealth is not an issue.

One can do is a **port scan.** This would basically tell attackers what is going on in the company servers, and what services are running.

Information collected here include:

* Versions of software running and common misconfigurations
* Brute-forcing passwords
* Subdomain fuzzing
* Testing website for obvious vulnerabilities
* Phishing (if allowed)
* Viewing company security policies and how the organisation is set up
* Checking anti-viruses and firewalls

### Combining

Once the lengthy enumeration process is done, attackers would need to map out all of the information retrieved and begin the attack planning process.&#x20;

How well the attack is planned would depend on the amount of information one can retrieve form the earlier recon stages. From here, attackers should be able to devise a good plan in order to pwn the company in one try.

How long is this recon phase? There have been some reports of black hats hacking a printer and staying inside that one printer monitoring the company for **more than 4 months**. That's how much enumeration and observation needs to be done.&#x20;

**I cannot emphasise how important this first stage of Recon is, because good enumeration is key for a good attack.**&#x20;

## Exploiting

The exploit part of the process. Only after gathering all the information, can one finally decide to act on it. The vulnerabilities found with the highest probability of success would be used. Exploits may be written and used on the servers. Typically, the most common vector would be websites.

The goal here is to gain remote access of a computer without authorization. That's called a **shell**. Once that has been achieved, attackers need to move fast to execute the next stage before getting caught. Stealth in the enumeration phase doesn't really matter if it's an internal test.

Past the recon phase, attackers tend to be stealthy before getting shut down.

## Privilege Escalation

&#x20;The initial access would always likely be some kind of low-privilege shell or a user shell. The goal here is to again, find some misconfigurations and permissions that we have to abuse to gain full control over the computer.

In an Active Directory setup, this would mean becoming the Domain Admin or controlling the DC. In standalone machines, we want to become the `root` user in Linux, or the Administrator / SYSTEM user in Windows machines.

Afterwards, we can dump credentials or move around the network.&#x20;

## Persistence

Persistence in an attack is the ability to remain there for long periods of time. For example, we would ideally want to maintain access to the one system we compromised even when the company closes, as we don't want to lose all the progress made. There is no guarantee that an exploit would work again after working again, especially if it was made possible using social engineering.

In this stage, as the administrator of the one system, attackers would start to download malware into the system (that bypasses anti-viruses) and backdoors. This would enable attackers to maintain access.

This portion also includes more scanning of the network within that one user, without raising suspicions. This would help find more vulnerabilities and flaws in the system that would pave the way for the next 2 steps.&#x20;

## Lateral Movement / Pivoting

After making a good solid foothold on the network, attackers would want to move around to other computers in the hopes of getting higher privileges, like compromising the admin of the entire network for example.

Also, attackers would want to access the non-public facing servers that the company has, if applicable.&#x20;

Attackers are able to move around the network, from system to system using **pivoting**. This is especially true if all computers in the network are interconnected to a domain, like in Active Directory, which is really common nowadays.

## Clean Up

Once the objective of the ROE has been met, like becoming domain admin or something, it is on the attackers to remove all fragments of the attack.

This includes removing all backdoors and files installed, as well as changing passwords of anything (if edited) and make it like the attack never happened. This is important, because we don't want to be leaving a fragment of anything for malicious attackers to stumble upon and use.

## Report Writing

The second most important part of the engagement. After exposing your l33t skills and pwning the system, remember that the company is hiring us to tell them about the vulnerabilities. As such, a full report, clearly showing the steps taken, exploits used and recommended fixes for the security is needed.

The main deliverable would be the **pentest report.** _This is the thing that allows attackers to get paid_. No matter how cool the exploit used is, if you don't submit a good, well documented  report, you won't get paid because you failed your job.

The report should contain both a high-level summary for management of the company to understand, as well as technical details and flaws for the tech team to work on.

Naturally, a good report would mean there needs to be good documentation of **every single step of the pentest. Make sure to take good notes, screenshots and proofs for everything that we do.**&#x20;

## Note

I attached some of my personal methodologies that I update now and then. **These methodologies are ONLY for HTB and boxes I do.**&#x20;
